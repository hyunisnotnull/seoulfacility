<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.office.seoul.facility.IFacilityDao">

	<select id="getAllFacility" parameterType="String" resultType="com.office.seoul.facility.FacilityDto">
		SELECT * FROM TBL_FACILITY
		<where>
	        <if test="type != null and type != ''">
	            AND MINCLASSNM = #{type}
	        </if>
	    </where>
	</select>
	
	<!-- 페이지별 데이터 조회 -->
    <select id="getFacilities" parameterType="Map" resultType="com.office.seoul.facility.FacilityDto">
        SELECT * FROM TBL_FACILITY
        <where>
	        <if test="type != null and type != ''">
	            AND (
                MINCLASSNM LIKE CONCAT('%', #{type}, '%')
                OR PLACENM LIKE CONCAT('%', #{type}, '%')
                OR AREANM LIKE CONCAT('%', #{type}, '%')
            )
	        </if>
	    </where>
        LIMIT #{offset}, #{size}
    </select>
    
    <!-- 전체 시설 수 조회 -->
    <select id="getTotalFacilitiesCount" parameterType="Map" resultType="Integer">
        SELECT COUNT(*) FROM TBL_FACILITY
        <where>
	        <if test="type != null and type != ''">
	            AND (
                MINCLASSNM LIKE CONCAT('%', #{type}, '%')
                OR PLACENM LIKE CONCAT('%', #{type}, '%')
                OR AREANM LIKE CONCAT('%', #{type}, '%')
            )
	        </if>
	    </where>
    </select>
    
    <!-- 시설 상세정보 -->
	<select id="getFacilityById" parameterType="String" resultType="com.office.seoul.facility.FacilityDto">
		SELECT * FROM TBL_FACILITY WHERE SVCID = #{id}	
	</select>
	
	<!-- 홈 빠른 예약 -->
	<select id="getAreas" resultType="String">
        SELECT DISTINCT AREANM FROM TBL_FACILITY
    </select>

    <select id="getCategoriesByArea" parameterType="String" resultType="String">
        SELECT DISTINCT MINCLASSNM FROM TBL_FACILITY
        WHERE AREANM = #{area}
    </select>

    <!-- 지역 및 카테고리 기반 결과 조회 -->
    <select id="getResults" parameterType="Map" resultType="String">
        SELECT DISTINCT SVCNM FROM TBL_FACILITY
        <where>
            <if test="area != null and area != ''">
                AND AREANM = #{area}
            </if>
            <if test="category != null and category != ''">
                AND MINCLASSNM = #{category}
            </if>
        </where>
    </select>
    
    <select id="getFacilityIdBySvcnm" parameterType="String" resultType="String">
    	SELECT SVCID FROM TBL_FACILITY WHERE SVCNM = #{svcnm} <!-- AND SVCSTATNM = '안내중' -->;
	</select>

    <select id="findFacilitiesByIds" 
    		parameterType="list" 
    		resultType="com.office.seoul.facility.FacilityDto">
    
        SELECT * FROM 
        	TBL_FACILITY
        WHERE 
        	SVCID IN
        <foreach item="facilityId" index="index" collection="facilityIds" open="(" separator="," close=")">
            #{facilityId}
        </foreach>
	</select>

	
</mapper>